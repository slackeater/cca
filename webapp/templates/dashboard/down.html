{% extends 'dashboard/tknDash.html' %}

{% block js %}
<script type="text/javascript">
function startDownload(){
	Dajaxice.downloader.checkDownload(downCallBack,{'t':tVal(),'i':iVal()})
}

function downCallBack(data){
	Dajax.process(data)	
}

{% if downStatus != None and downStatus != -1  and downStatus != 5 and downStatus != 6%}
setInterval(function(){ startDownload()},2500)
{% endif %}

</script>

{% endblock %}


{% block rightcont %}

<h2>Account</h2>

{{acc}}

<h2>Download</h2>

<p>The download will include:
<ol>
	<li>the metadata</li>
	<li>the files themselves</li>
	<li>the history of the files if any</li>
</ol>

<p>The download may take some times depending on the network speed, the load of the API service of Google/Dropbox/OneDrive and
the size of the files.<p>

<p>
The download will happen in background and notifications will appear in this page about the status of download.
</p>

<p>You have to provide the credentials for the TSA (Timestamping Authority) so that a signed timestamp can be generated at the end of the download process</p>

<form name="d" method="POST" action="">
	{% csrf_token %}
	<table>
		<tr><td>{{form.uname.label}}</td><td>{{form.uname}}</td></tr>
		<tr><td>{{form.pwd.label}}</td><td>{{form.pwd}}</td></tr>
		<tr><td></td><td><input type="submit" name="start" value="Download" /></td></tr>
	</table>
</form>
</p>

<div id="errors">{{errors}}</div>

<table id="downTable">
	<tr><td>Download status</td><td><div id="thStatus">{% if downStatus == -1 %}No download have been started.{%elif downStatus == 5 %}Download already completed.{%elif downStatus == 6 %}Error{%endif%}</div></td><td><div id="thMessage">{{downMessage}}</div></td></tr>
	<tr><td>Credential Verified</td><td colspan=2><div id="status1">{{credVerified}}</div></td></tr>
	<tr><td>Metadata Download</td><td colspan=2><div id="status2">{{metaWait}}</div></td></tr>
	<tr><td>Computing Download Size</td><td><div id="status3">{{downSize}}</div></td><td>Approximate download size (without history):<div id="fileSize">-</div> MB</td></tr>
	<tr><td>Download Files and History</td><td colspan=2><div id="status4">{{fileWait}}</div></td></tr>
	<tr><td>Verification</td><td colspan=2><div id="status5">{{verificationWait}}</div></td></tr>
</table>

{% endblock %}
